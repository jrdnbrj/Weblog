<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <div class="container">
        <div class="row mt-5">
            <div class="col-7">
                <h3>Authors</h3>
                <table class="table table-sm">
                    <tr class="bg-info">
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                    {% for author in authors %}
                        <tr>
                            <th>{{ author.name }}</th>
                            <td>{{ author.email }}</td>
                        </tr>
                    {% endfor %}
                </table>
                <hr>
                <h3>Entrys</h3>
                <table class="table table-sm">
                    <tr class="bg-info">
                        <th>HeadLine</th>
                        <th>Date</th>
                        <th>Body Text</th>
                        <th>Authors</th>
                        <th></th>
                    </tr>
                    {% for entry in entrys %}
                        <tr>
                            <th>
                                {{ entry.headline }}
                            </th>
                            <td style="width:95px"><small>{{ entry.date }}</small></td>
                            <td><small><small>{{ entry.body_text }}</small></small></td>
                            <td>{% for author in entry.authors.all %}Â·{{ author }}<br>{% endfor %}</td>
                            <td style="width: 100px">
                                <span class="fa fa-star"></span>
                                 <span class="badge badge-secondary">{{ entry.number_of_comments }}</span>
                                <span class="fa fa-envelope-open"></span>
                                <span class="badge badge-secondary">{{ entry.rating }}</span>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="col-5">
                <div class="input-group">
                    {% csrf_token %}
                    <div class="input-group-prepend">
                        <label class="input-group-text" >Options</label>
                    </div>
                    <select class="custom-select" id="option">
                        <option value="0" selected>Choose...</option>
                        <option value="1">Autores - Rating</option>
                        <option value="2">Autores - Comentarios</option>
                    </select>
                </div>
                <table class="table mt-4">
                    <tr class="bg-success">
                        <th class="text-center">#</th>
                        <th class="text-center">First</th>
                    </tr>
                    <tbody id="list">
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>

        $(document).ready(inicio);
        $('#option').on('change', inicio);

        function inicio(){
            var option = $('#option').val();
            console.log(option);
            var csrfToken = $('[name="csrfmiddlewaretoken"]').val();

            $.ajax({
                data: {'csrfmiddlewaretoken': csrfToken,
                       'option': option,
                       },
                url: "{% url 'ajax' %}",
                type: 'post',
                success: function(data){
                    response = data.response
                    console.log(response)
                    
                    
                    $('#list').html("");
                    for (var r in response){
                        console.log(r + ',' + response[r])
                        $('#list').append(
                        `<tr>
                            <th class="text-center">` + r + `</th>
                            <td class="text-center">` + response[r] + `</td>
                        </tr>`);
                    }
                }
            }).fail(function (data){
                alert("fail");
            })
        }

    </script>
</html>